import 'package:google_maps_flutter/google_maps_flutter.dart';

/// Polígono del Callao (coordenadas invertidas: [lat, lng])
final List<LatLng> callaoPolygon = [
  LatLng(-12.132269425244274, -77.19243354613003),
  LatLng(-12.077083138298875, -77.11009809421624),
  LatLng(-12.073851007008358, -77.10752733078789),
  LatLng(-12.071696231146305, -77.10495656735954),
  LatLng(-12.063898541003923, -77.1042567250847),
  LatLng(-12.061281236880305, -77.08843023103383),
  LatLng(-12.051943311869962, -77.08769572719739),
  LatLng(-12.049429199608454, -77.0774126734835),
  LatLng(-12.046555899617019, -77.0770454215653),
  LatLng(-12.046915063798437, -77.08181969650381),
  LatLng(-12.04476007150761, -77.082186948422),
  LatLng(-12.036858285164314, -77.08402320801397),
  LatLng(-12.038294990878768, -77.09247000213549),
  LatLng(-12.033984850691738, -77.09614252131934),
  LatLng(-12.023568393257278, -77.09136824638082),
  LatLng(-12.015665984053484, -77.08806297911559),
  LatLng(-12.009918631640403, -77.09247000213549),
  LatLng(-12.00524881749152, -77.09540801748248),
  LatLng(-12.004889597665795, -77.100182292421),
  LatLng(-11.997345870715478, -77.10348755968623),
  LatLng(-12.000219696353795, -77.10716007886968),
  LatLng(-11.99411278025687, -77.11009809421624),
  LatLng(-11.996986640355985, -77.1141378653179),
  LatLng(-11.994831248153616, -77.1185448883382),
  LatLng(-11.991598127548258, -77.11817763642),
  LatLng(-11.982257783713493, -77.11266885764459),
  LatLng(-11.975431943449308, -77.11119984997134),
  LatLng(-11.9707615323004, -77.11781038450134),
  LatLng(-11.967168853411124, -77.11634137682805),
  LatLng(-11.956749814655083, -77.11817763642),
  LatLng(-11.953875526442161, -77.12074839984832),
  LatLng(-11.950282623247375, -77.12074839984832),
  LatLng(-11.942737371334474, -77.12735893437836),
  LatLng(-11.938066332371832, -77.12882797948197),
  LatLng(-11.939503564198404, -77.12515546029854),
  LatLng(-11.944893115648625, -77.12074843727822),
  LatLng(-11.946330311256816, -77.11303614699315),
  LatLng(-11.94956397348804, -77.095775306831),
  LatLng(-11.939503564198404, -77.09908057409581),
  LatLng(-11.93519184585044, -77.10348759711613),
  LatLng(-11.928364818207811, -77.10238584136101),
  LatLng(-11.925130903021298, -77.09724431450431),
  LatLng(-11.905007898304348, -77.0924700395658),
  LatLng(-11.901414347733251, -77.08953202421922),
  LatLng(-11.89243026351248, -77.09320454340265),
  LatLng(-11.874461205244472, -77.09504080299415),
  LatLng(-11.869070256605795, -77.10054958176956),
  LatLng(-11.858288039554836, -77.10091683368775),
  LatLng(-11.859006867284023, -77.10532385670804),
  LatLng(-11.853615613161551, -77.10862912397285),
  LatLng(-11.85325619243386, -77.11156713931986),
  LatLng(-11.850021384589752, -77.11230164315627),
  LatLng(-11.850740234089812, -77.1148724065851),
  LatLng(-11.848224252562957, -77.11634141425836),
  LatLng(-11.847505396440084, -77.11266889507495),
  LatLng(-11.839957292948213, -77.11560691042152),
  LatLng(-11.834925108131031, -77.11523965850328),
  LatLng(-11.829892885553647, -77.11707603997195),
  LatLng(-11.819109122221946, -77.12735909368584),
  LatLng(-11.817311787029496, -77.13176611670572),
  LatLng(-11.818030722522693, -77.13947840699126),
  LatLng(-11.821265908878914, -77.14278367425605),
  LatLng(-11.819468587844497, -77.1479252011132),
  LatLng(-11.821625371669597, -77.15086321645978),
  LatLng(-11.822344295835848, -77.15563749139831),
  LatLng(-11.825938888338214, -77.15673924715335),
  LatLng(-11.824501057002223, -77.16224802592875),
  LatLng(-11.826657801172757, -77.16408428552026),
  LatLng(-11.825938888338214, -77.1681240566219),
  LatLng(-11.826657801172757, -77.17032756813207),
  LatLng(-11.825219973614978, -77.17583634690745),
  LatLng(-11.8288145283436, -77.17730535458072),
  LatLng(-11.828095621175976, -77.18207962951924),
  LatLng(-11.825938888338214, -77.18465039294763),
  LatLng(-11.828095621175976, -77.18795566021284),
  LatLng(-11.839238469927537, -77.18648665253956),
  LatLng(-11.844270575330086, -77.1842831410294),
  LatLng(-12.078189999177667, -77.25729616849753),
  LatLng(-12.132269425244274, -77.19243354613003),
];

/// Algoritmo "point in polygon" para validar si un punto está dentro del Callao
bool isPointInCallao(LatLng point) {
  int intersectCount = 0;
  for (int j = 0; j < callaoPolygon.length - 1; j++) {
    if (_rayCastIntersect(point, callaoPolygon[j], callaoPolygon[j + 1])) {
      intersectCount++;
    }
  }
  return (intersectCount % 2) == 1;
}

bool _rayCastIntersect(LatLng point, LatLng vertA, LatLng vertB) {
  double aY = vertA.latitude;
  double bY = vertB.latitude;
  double aX = vertA.longitude;
  double bX = vertB.longitude;
  double pY = point.latitude;
  double pX = point.longitude;

  if ((aY > pY && bY > pY) || (aY < pY && bY < pY) || (aX < pX && bX < pX)) {
    return false;
  }

  double m = (bY - aY) / (bX - aX);
  double bee = -aX * m + aY;
  double x = (pY - bee) / m;

  return x > pX;
}